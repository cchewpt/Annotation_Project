{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <meta name="description" content="" />
    <meta name="author" content="" />
    <title>ระบบการกำกับข้อความเชิงบูลลี่ภาษาไทย</title>
    <!-- Favicon-->
    <link rel="icon" type="image/x-icon" href="assets/favicon.ico" />
    <!-- Custom Google font-->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@100;200;300;400;500;600;700;800;900&amp;display=swap"
      rel="stylesheet"
    />
    <!-- Bootstrap icons-->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css"
      rel="stylesheet"
    />
    <!-- Core theme CSS (includes Bootstrap)-->
    <link href="{% static 'css/styles.css' %}" rel="stylesheet" />
  </head>

  <body class="d-flex flex-column h-100 bg-dark">
    <!-- Navigation-->
    <nav class="navbar navbar-expand-lg navbar-light py-3 bg-greydarker">
      <div class="container px-5">
        <a class="navbar-brand" href="{% url 'mainlogin' %}">
          <span class="fw-bolder border-rounded" style="color: black">
            ระบบการกำกับข้อความเชิงบูลลี่ภาษาไทย
          </span>
        </a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarSupportedContent"
          aria-controls="navbarSupportedContent"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav ms-auto mb-2 mb-lg-0 small fw-bolder">
            <li class="nav-item"><a class="nav-link" href="{% url 'mainlogin' %}">หน้าแรก</a></li>
            <li class="nav-item"><a class="nav-link" href="{% url 'annotatepage' %}">กำกับข้อความ</a></li>
            <li class="nav-item"><a class="nav-link" href="{% url 'txtverify' %}">วิเคราะห์ข้อความ</a></li>
            <li class="nav-item"><a class="nav-link" href="{% url 'texttopost' %}">เสนอข้อความ</a></li>
        </ul>
          <div class="user-profile-box m-lg-0 py-1">
            <div class="d-inline-flex align-items-center">
                <img src="{% static 'assets/profile-placeholder.png' %}" alt="User Picture"
                    style="width: 40px; height: 40px; cursor: pointer" class="rounded-circle me-2"
                    onclick="location.href='{% url 'admin_profile' %}';" />
          
                <div class="d-md-flex flex-column">
                    <span class="fw-medium" style="color: black; cursor: pointer">ชื่อผู้ใช้: {{ username }}</span>
                    <a href="{% url 'index' %}" class="d-block fw-semibold text-danger">ออกจากระบบ</a>
                </div>
            </div>
          </div>
        </div>
      </div>
    </nav>

    <main class="flex-shrink-1">
      <div class="container px-3">
        <div class="row my-5">
          <div class="col-lg-3">
            <div class="pb-3 d-inline-flex align-items-center">
              <div class="d-inline-flex align-items-center">
                <img
                  class="rounded-circle"
                  src="../static/assets/profile-placeholder.png"
                  alt="..."
                  style="width: 80px; height: 80px"
                />
              </div>
              <div class="d-md-flex flex-column offset-1">
                <span class="fw-medium text-white" style="color: black"
                  >ชื่อผู้ใช้: sayan1989</span
                >
                <span class="fw-medium text-white" style="color: black"
                  >รหัสผู้ใช้: A01</span
                >
              </div>
            </div>
            <div class="d-grid gap-3">
              <button
                class="btn btn-light d-flex align-items-center"
                type="button"
                onclick="location.href='{% url 'admin_edit_profile' %}';"
              >
                <i class="bi bi-tools me-2"></i> แก้ไขบัญชี
              </button>

              <button
                class="btn btn-light d-flex align-items-center"
                type="button"
                onclick="location.href='{% url 'admin_edit_user' %}';"
              >
                <i class="bi bi-kanban me-2"></i> จัดการบัญชีผู้ใช้
              </button>


              <button
                class="btn btn-light d-flex align-items-center"
                type="button"
                onclick="location.href='{% url 'admin_approved1' %}';"
              >
                <i class="bi bi-check-lg me-2"></i> อนุมัติข้อความเชิงบูลลี่
              </button>


              <button
                class="btn btn-light d-flex align-items-center"
                type="button"
                onclick="location.href='{% url 'admin_mng_datasets1' %}';"
              >
                <i class="bi bi-pen me-2"></i> เพิ่มลบชุดข้อมูลในการกำกับ
              </button>


              <button
                class="btn btn-light d-flex align-items-center"
                type="button"
                onclick="location.href='{% url 'admin_kappa' %}';"
              >
                <i class="bi bi-check-lg me-2"></i> ตรวจสอบคะแนนความเชื่อมั่น
              </button>

              
              <button
                class="btn btn-light d-flex align-items-center"
                type="button"
              >
                <i class="bi bi-gear-fill me-2"></i> จัดการชุดข้อมูลเพื่อฝึกสอนโมเดล
              </button>
              <button
                class="btn btn-light d-flex align-items-center"
                type="button"
              >
                <i class="bi bi-gear-fill me-2"></i> ฝึกสอนโมเดล
              </button>
              <button
                class="btn btn-danger d-flex align-items-center"
                type="button"
              >
                <i class="bi bi-box-arrow-right me-2"></i> ออกจากระบบ
              </button>
            </div>
          </div>

          <div class="col-lg-9">
            <form method="POST" action="{% url 'admin_add_datasets' %}">
                {% csrf_token %}
                <div class="dataset-creation-box p-4 bg-light rounded">
                    <div class="mb-3">
                        <input type="text" class="form-control" placeholder="กรอกชื่อชุดข้อความ" name="task_name" required />
                    </div>
                    <div class="d-flex align-items-center mb-3">
                        <input type="date" class="form-control me-2" name="created_date" required />
                        <span class="me-2 mt-1 form-label">ถึง</span>
                        <input type="date" class="form-control me-2" name="due_date" required />
                        <button type="button" class="btn btn-purple" onclick="showApprovalForm()">ข้อความจากผู้ใช้</button>
                    </div>
                    <!-- Hidden Approval Form -->
                    <div id="approvalForm" style="display:none;">
                      <div class="container">
                          <div class="card border-danger">
                              <ul id="approvalList">
                                  {% for proposed_text in proposed_texts %}
                                      <li>
                                          <span class="item-number">{{ forloop.counter }}.</span>
                                          <span class="item-text">{{ proposed_text.proposed_text }}</span>
                                          <span class="item-date">User ID: {{ proposed_text.user_id }}</span>
                                          <input type="checkbox" class="item-checkbox" value="{{ proposed_text.proposed_text }}">
                                      </li>
                                  {% empty %}
                                      <li>No proposed texts found.</li>
                                  {% endfor %}
                              </ul>
                              <button type="button" class="btn btn-success add-text-button" onclick="addSelectedTexts()">เพิ่มข้อความ</button>
                          </div>
                      </div>
                  </div> <!-- End of Approval Form -->
                  
                  <div class="p-3 red-border-box mb-3">
                      <label for="textEntry" class="form-label">กรอกข้อความที่ต้องการเพิ่ม</label>
                      <div class="d-flex align-items-center">
                          <input type="text" class="form-control me-2" id="textEntry" placeholder="กรอกข้อความ..." />
                          <button type="button" class="btn btn-purple" onclick="addTextEntry()">เพิ่ม</button>
                      </div>
                      <ul class="list-unstyled mt-3" id="textEntriesList"></ul>
                  </div>
                  
                  <button type="submit" class="btn btn-success w-100">เพิ่มชุดข้อมูล</button>
                  
                  <script>
                      let entryCount = 1; // This will track your entries
                      const annotatedTexts = []; // Array to hold annotated text entries
                      const annotatedIds = []; // Array to hold annotated IDs as integers
                  
                      function showApprovalForm() {
                          const approvalForm = document.getElementById('approvalForm');
                          if (approvalForm.style.display === 'none' || approvalForm.style.display === '') {
                              approvalForm.style.display = 'block'; // Show the approval form
                          } else {
                              approvalForm.style.display = 'none'; // Hide the approval form
                          }
                      }
                  
                      function addTextEntry() {
                          const textEntry = document.getElementById('textEntry').value;
                          if (textEntry.trim() !== '') {
                              const listItem = document.createElement('li');
                              listItem.classList.add('d-flex', 'justify-content-between', 'align-items-center', 'my-1');
                              listItem.innerHTML = `<span>${textEntry}</span> <button type="button" class="btn btn-danger btn-sm" onclick="removeTextEntry(this)">ลบ</button>`;
                              document.getElementById('textEntriesList').appendChild(listItem);
                              annotatedTexts.push(textEntry); // Store the annotated text
                              annotatedIds.push(entryCount++); // Store the corresponding ID
                              document.getElementById('textEntry').value = ''; // Clear the input
                          }
                      }
                  
                      function addSelectedTexts() {
                          const selectedTexts = [];
                          const checkboxes = document.querySelectorAll('#approvalList .item-checkbox:checked');
                  
                          checkboxes.forEach((checkbox) => {
                              selectedTexts.push(checkbox.value);
                          });
                  
                          selectedTexts.forEach(text => {
                              const listItem = document.createElement('li');
                              listItem.classList.add('d-flex', 'justify-content-between', 'align-items-center', 'my-1');
                              listItem.innerHTML = `<span>${text}</span> <button type="button" class="btn btn-danger btn-sm" onclick="removeTextEntry(this)">ลบ</button>`;
                              document.getElementById('textEntriesList').appendChild(listItem);
                              annotatedTexts.push(text); // Store the annotated text
                              annotatedIds.push(entryCount++); // Store the corresponding ID
                          });
                  
                          // Hide selected checkboxes and their text
                          checkboxes.forEach((checkbox) => {
                              const listItem = checkbox.closest('li');
                              if (listItem) {
                                  listItem.style.display = 'none'; // Hide the entire list item
                              }
                              checkbox.checked = false; // Uncheck the checkbox
                          });
                      }
                  
                      function removeTextEntry(button) {
                          const listItem = button.parentElement; // The list item containing the button
                          const textToRemove = listItem.querySelector('span').innerText; // Get the text to remove
                  
                          // Find the checkbox for this text and show it again
                          const checkboxes = document.querySelectorAll('#approvalList .item-checkbox');
                          checkboxes.forEach((checkbox) => {
                              if (checkbox.value === textToRemove) {
                                  const proposedListItem = checkbox.closest('li');
                                  if (proposedListItem) {
                                      proposedListItem.style.display = 'block'; // Show the corresponding proposed text
                                  }
                              }
                          });
                  
                          const index = Array.from(listItem.parentNode.children).indexOf(listItem);
                          annotatedTexts.splice(index, 1); // Remove text entry from array
                          annotatedIds.splice(index, 1); // Remove corresponding ID
                          listItem.remove(); // Remove from list
                      }
                  
                      document.querySelector('form').addEventListener('submit', function (event) {
                          const taskNameInput = document.querySelector('input[name="task_name"]');
                          if (!taskNameInput.value) {
                              alert('กรุณากรอกชื่อชุดข้อความ'); // Prompt user for task name if empty
                              event.preventDefault();
                              return;
                          }
                          // Append hidden inputs to the form before submitting
                          const annotatedTextsInput = document.createElement('input');
                          annotatedTextsInput.type = 'hidden';
                          annotatedTextsInput.name = 'annotated_texts'; // Ensure this matches your backend expectation
                          annotatedTextsInput.value = JSON.stringify(annotatedTexts); // Convert array to string
                  
                          const annotatedIdsInput = document.createElement('input');
                          annotatedIdsInput.type = 'hidden';
                          annotatedIdsInput.name = 'annotated_ids'; // Ensure this matches your backend expectation
                          annotatedIdsInput.value = JSON.stringify(annotatedIds); // Convert array to string
                  
                          this.appendChild(annotatedTextsInput);
                          this.appendChild(annotatedIdsInput);
                      });
                  </script>
          </div>
          
        </div>
      </div>
    </main>

    <!-- Footer-->
    <footer class="bg-brightred py-4 mt-auto">
      <div class="container px-5">
        <div
          class="row align-items-center justify-content-between flex-column flex-sm-row"
        >
          <div class="col-auto">
            <div class="small-black m-0">
              ระบบกำกับและทำนายข้อความเชิงบูลลี่ภาษาไทย &copy;
            </div>
          </div>
          <div class="col-auto">
            <a class="small-black">ติดต่อเรา 023342234</a>
            <span class="mx-1">&middot;</span>
            <a class="small-black">Email : info@thaitextbul.co</a>
            <span class="mx-1">&middot;</span>
            <a class="small-black">Line : thaitextbul</a>
          </div>
        </div>
      </div>
    </footer>
    <!-- Bootstrap core JS-->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Core theme JS-->
    <script src="js/scripts.js"></script>
  </body>
</html>